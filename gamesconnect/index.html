<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" href="/logo.png"><head>
    <meta charset="UTF-8">
    <title>Connecting to Games... - Camcookie</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="/script.js"></script>
  </head>
<body>
<div class="Topbar"><div class="Topbar-inner"><a href="https://camcookie876.github.io/" class="Topbar-logo"><img src="https://camcookie876.github.io/logo.png" alt="Camcookie Logo"></a><div class="Topbar-links"><noscript><a href="/links"></a></noscript></div><div class="Topbar-right"><div class="Topbar-menu-btn">|||</div></div></div><div class="Topbar-dropdown"></div><div class="Topbar-login-dropdown"></div></div>

<center><h1 class="header">Camcookie</h1></center>
<div class="content">

  <h2>Connecting to Camcookie Games…</h2>

  <noscript>
    <p class="error">JavaScript is required to continue.</p>
    <p>Please enable JavaScript and try again.</p>
  </noscript>

  <p id="status">Reading login data…</p>

</div>
<p>Copyright 2025 by Camcookie</p>
<script>
  const status = document.getElementById("status");

  // Read Connect 26 session
  const session = localStorage.getItem("sb-bafcfszceittoberpgdz-auth-token");

  if (!session) {
    status.innerHTML = `
      <span class="error">No login session found.</span><br>
      Please sign in again.<br><br>
      <a href="https://camcookie876.github.io/connect/26/">Camcookie Connect 26</a>
    `;
    throw new Error("No session");
  }

  let data;
  try {
    data = JSON.parse(session);
  } catch (e) {
    status.innerHTML = `
      <span class="error">Corrupted login session.</span><br>
      Please sign in again.
    `;
    throw e;
  }

  const token = data.access_token;
  const id = data.user?.id;

  if (!token || !id) {
    status.innerHTML = `
      <span class="error">Missing login information.</span><br>
      Please sign in again.<br><br>
      <a href="https://camcookie876.github.io/connect/26/">Camcookie Connect 26</a>
    `;
    throw new Error("Missing token or id");
  }

  // Redirect to Camcookie Games
  const url =
    "https://camcookieg.github.io/auth/receive.html" +
    `?token=${encodeURIComponent(token)}` +
    `&id=${encodeURIComponent(id)}`;

  status.textContent = "Redirecting…";
  location.href = url;
</script>
</body>
</html>